---
title: "Projet de biostatistiques"
author: "LANCON Cindy, FRISON Victor"
date: "2025-12-17"
output:
  html_document:
    toc: true
  pdf_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(car)
library(dplyr)
library(ggplot2)
library(gtsummary)
library(MASS)
library(pROC)

data <- read.csv2("data/Table.csv", header=TRUE)

```

```{r, include=FALSE}
#Vérifier type de données
str(data)

#Variable quantitative
data$age <- as.numeric(data$age)
data$imc <- as.numeric(data$imc)
data$cholesterol_total <- as.numeric(data$cholesterol_total)

#Variable factor
data$statut_cas_temoin <- factor(data$statut_cas_temoin)
data$sexe <- factor(data$sexe)
data$tabagisme <- factor(data$tabagisme)
data$hypertension <- factor(data$hypertension)
data$diabete <- factor(data$diabete)
data$niveau_activite_physique <- factor(data$niveau_activite_physique)
data$consommation_alcool <- factor(data$consommation_alcool)
data$region <- factor(data$region)
```

# ***Étude cas-témoin sur l’infarctus du myocarde***

Cette étude cas-témoin porte sur l'infarctus du myocarde aigu. Les cas sont des patients hospitalisés pour un premier infarctus du myocarde confirmé. Les témoins sont des patients hospitalisés dans les mêmes hopitaux, pour des pathologies non cardiovasculaires, sans antécédent de maladie coronarienne.

L'objectif de ce projet est d'analyser le lien entre plusieurs facteurs de risque (tabagisme, hypertension...) et la survenue d'un infarctus du myocarde.

L'échantillon comprend 520 patients, dont 260 cas et 260 témoins.

Les différentes variables explicatives possibles sont :

-   **Âge** (en années)
-   **Sexe**
-   **Tabagisme** : jamais fumeur, ancien fumeur, fumeur actuel
-   **IMC** (kg/m²)
-   **Hypertension artérielle** (oui / non)
-   **Diabète** (oui / non)
-   **Cholestérol total** (mmol/L)
-   **Niveau d’activité physique** : faible, modéré, élevé
-   **Consommation d’alcool** : nulle ou occasionnelle, modérée, élevée
-   **Région** de l’hôpital de prise en charge

## Définitions et théorie

### Définition de l'odds

Pour un évenement A tel que $\mathbb{P}(A) \neq1$, on appelle odds de A la quantité : $odds(A) = \frac{\mathbb P(A)}{1-\mathbb P(A)}$. C'est le rapport entre la probabilité que l'évènement se produise et qu'il ne se produise pas.

### Modèle logistique

Pour une variable explicative X quantitative, le modèle logistique suppose qu'il existe $\beta \in \mathbb R^p$ tel que :

$$
\mathbb P(Y=1 | \space X=x) = F(<\beta,x>) = \frac{exp(<\beta,x>)}{1+exp(<\beta,x>)}
$$

où F est la fonction de répartition de la loi logistique. De plus, dans le modèle logistique, on a :

$$
odds(Y=1 | \space X=x) = \frac{\mathbb P(Y=1 | \space X=x)}{\mathbb P(Y=0 | \space X=x)} = exp(<\beta,x>)
$$

## Analyse exploratoire et Statistiques Descriptives

Avant de faire nos régressions logistiques, nous allons commencer par une analyse exploratoire de nos données et regarder quelques statistiques descriptives. Cela nous permettera de voir si l'on a des différence entre nos cas et témoins, mais également regarder si l'on a des interactions entre nos variables.

```{r, echo=FALSE}
table1 <- data %>%
  dplyr::select(-id_sujet) %>% 
  tbl_summary(
    by = statut_cas_temoin, # On compare selon le statut
    statistic = list(all_continuous() ~ "{mean} ({sd})", 
                     all_categorical() ~ "{n} ({p}%)"),
    digits = all_continuous() ~ 1,
    label = list(age ~ "Âge (années)", imc ~ "IMC (kg/m²)", cholesterol_total ~ "Cholestérol")
  ) %>%
  add_p() %>%      # Ajoute les p-values (test Chi2 ou Wilcoxon/T-test auto)
  add_overall() %>% # Ajoute une colonne "Total"
  bold_labels() %>% 
  modify_caption("**Tableau 1.** Comparaison cas/témoins.  \n*Réalisé avec la librairie **gtsummary** avec l'aide de **Gemini***")

table1
```

**Interprétation des résultats**

L'analyse porte sur un échantillon total de 520 sujets, répartis équitablement entre cas (N=260) et témoins (N=260).

**Caractéristiques sociodémographiques** Les cas sont **significativement plus âgés** que les témoins, avec une moyenne d'âge de 64,3 ans contre 58,1 ans ($p < 0,001$). En revanche, aucune différence significative n'a été observée concernant la répartition par **sexe** ($p = 0,10$) ou la **région** d'origine ($p = 0,3$).

**Mode de vie et comportements** Le groupe des cas présente des habitudes de vie plus à risque ($p < 0,001$) : \* **Tabac :** La prévalence du tabagisme actuel est presque deux fois plus élevée chez les cas (48%) que chez les témoins (25%). \* **Activité physique :** La sédentarité est prédominante chez les cas, avec 65% déclarant une activité "Faible", contre 38% chez les témoins. \* **Alcool :** Une consommation élevée (\>3 verres/j) est plus fréquente chez les cas (18% vs 7,3%).

**Caractéristiques cliniques** Sur le plan clinique, les cas présentent un profil de santé plus dégradé. Ils affichent un **IMC** moyen supérieur (28,7 vs 26,6 kg/m$^2$) ainsi qu'un taux de **cholestérol total** plus élevé. Les comorbidités sont également plus fréquentes chez les cas, notamment l'**hypertension** (69% vs 51%) et le **diabète** (29% vs 16%). Toutes ces différences cliniques sont statistiquement significatives ($p < 0,001$).

## Niveau de référence des variables

```{r, include=FALSE}
lapply( data[, sapply(data, is.factor)], levels)

#Changement référence
## Référence = Témoin (car on veut la proba d'être CAS par rapport aux TEMOINS)
data$statut_cas_temoin <- relevel(data$statut_cas_temoin, ref="Témoin")

#Référence = Jamais
data$tabagisme <- relevel(data$tabagisme, ref = "Jamais")
```

Avant de commencer nos analyses et nos modèles de régressions logistiques, nous allons changer les variables de références pour nos variables qualitatives.

\- **Statut cas-témoin** : "Témoin" (pour estimer le risque de devenir cas)
- **Tabagisme** : "Jamais" (pour comparer fumeurs vs non-fumeurs)
- **Hypertension, Diabète** : "Non" (pour comparer présence vs absence)
- **Activité physique** : "Élevée" (pour évaluer l'effet de la sédentarité)
- **Consommation d'alcool** : "Aucune ou occasionnelle" (pour comparer les niveaux de consommation)

Donc pour cas-temoins, on met **témoins** en référence car on s'intéresse au risque de passé de témoins à cas.

## Regression logistique simple / univarié

Dans cette partie, nous allons tester de faire des `glm` simple pour chacune de nos variables avec le type code suivant :

```{r, eval=FALSE}
# Définition du Modèle
mod_age <- glm(statut_cas_temoin ~ age, family = binomial, data = data)

# Statistiques et intervalle de confiance
summary(mod_age)
IC_age <- confint(mod_age)
IC_exp_age <- exp(confint(mod_age))

anova(mod_age, test = "Chisq")
```

Dans la suite nous n'afficherons plus le code pour éviter les répétitions.

### Variable Age

On obtient les sorties suivantes (dans la suite nous analyserons juste les résultats sans inclure les sorties) :

```{r, echo=FALSE}
# Modèle
mod_age <- glm(statut_cas_temoin ~ age, family = binomial, data = data)

# Statistiques et intervalle de confiance
summary(mod_age)
IC_age <- confint(mod_age)
IC_exp_age <- exp(confint(mod_age))

IC_age
IC_exp_age

anova(mod_age, test = "Chisq")
```

On obtient le coefficient $\hat{\beta}_{age} = 0.083$ qui estime $\beta_{age} = \ln\left(\frac{odds(Y=1 \mid \space age=x+1)}{odds(Y=1 \mid\space age=x)}\right)$. L'odds ratio est estimé à : $\exp(\hat{\beta}_{age})=1.09$.

L'intervalle de confiance à 95% de l'odds ratio est : $\exp(\beta_{age}) \in [1.06; 1.11]$.

Ainsi, cela signifie que pour chaque année d'âge supplémentaire, l'odds de faire un infarctus est multiplié par au moins **1.06** et au plus **1.11**. Autrement dit, le risque augmente d'environ 6% à 11% par an.

Comme l'intervalle ne contient pas la valeur 1 (borne inférieure \> 1) et que la p-value est extrêmement faible ($p < 0.001$), l'âge est alors un facteur de risque et est donc significativement associé à la survenue de l'infarctus du myocarde.

Ces résultats suggèrent qu'une augmentation de l'âge, augmente le risque d'être cas.

### Variable IMC

```{r, include=FALSE}
# Modèle
mod_imc <- glm(statut_cas_temoin ~ imc, family = binomial, data = data)

# Statistiques et intervalle de confiance
summary(mod_imc)
IC_imc <- confint(mod_imc)
IC_exp_imc <- exp(confint(mod_imc))

IC_imc
IC_exp_imc

anova(mod_imc, test = "Chisq")
```

On obtient $\hat{\beta}_{imc} = 0.148$ qui estime $\beta_{imc} = \ln\left(\frac{odds(Y=1 \mid \space IMC=x+1)}{odds(Y=1 \mid \space IMC=x)}\right)$. L'odds ratio est estimé à : $\exp(\hat{\beta}_{IMC})=1.16$.

L'intervalle de confiance à 95% de l'odds ratio est : $\exp(\beta_{imc}) \in [1.10; 1.22]$.

Ce qui signifie qu'une augmentation d'une unité d'IMC supplémentaire, multiplie l'odds d'être cas par au moins 1.10 et au plus 1.22.

La p-value étant très faible ($6.7 \times 10^{-10}$), l'IMC est significativement associée à la survenue de l'infarctus du myocarde. Cela suggère que plus l'IMC est élevé, plus le risque d'être cas augmente..

### Variable Cholesterol

```{r, include=FALSE}
# Modèle
mod_chol <- glm(statut_cas_temoin ~ cholesterol_total, family = binomial, data = data)

# Statistiques et intervalle de confiance
summary(mod_chol)
IC_chol <- confint(mod_chol)
IC_exp_chol <- exp(confint(mod_chol))

IC_chol
IC_exp_chol

anova(mod_chol, test = "Chisq")
```

On obtient $\hat{\beta}_{chol} = 0.785$ qui estime $\beta_{chol} = \ln\left(\frac{odds(Y=1 \mid \space chol=x+1)}{odds(Y=1 \mid \space chol=x)}\right)$. L'odds ratio est estimé à : $\exp(\hat{\beta}_{chol})=2.19$.

L'intervalle de confiance à 95% de l'odds ratio est : $\exp(\beta_{chol}) \in [1.79; 2.71]$.

Cela signifie qu'une augmentation d'une unité de cholestérol total, multiplie l'odds d'être cas par au moins 1.79 et au plus 2.71.

La p-value est très inférieure au seuil de 0.05, confirmant que le cholesterol est un facteur de risque majeur et significatif au seuil de 5%. Plus le niveau de cholésterol est élevée, plus le risque d'être cas augmente.

### Variable Sexe

```{r, include=FALSE}
#Modèle
mod_sexe <- glm(statut_cas_temoin~sexe, family=binomial, data=data)

#Statistiques et intervalle de confiance
summary(mod_sexe)
IC_sexe <- confint(mod_sexe)
IC_exp_sexe <- exp(confint(mod_sexe))

IC_sexe
IC_exp_sexe

anova(mod_sexe, test = "Chisq")
```

La modalité de référence est "Femme".

$\hat{\beta}_{H} = 0.307$ estime le coefficitent $\beta_{H}=ln(\frac{odds(Y=1 \space | \space sexe=Homme)}{odds(Y=1 \space | \space sexe= Femme)})$.

L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{H}) \in [e^{-0.05} ; e^{0.67}] = [0.95;1.95]$.

Comme 1 appartient à l'intervalle de confiance, on ne peut pas mettre en évidence d'association statistique. De plus, Nous obtenons une p-value supérieure au seuil de 0.05, ce qui signifie que le sexe n'a pas d'effet statistiquement significatif au seuil de 5% sur le fait d'être cas. On retrouve donc bien la même conclusion que dans notre analyse exploratoire.

### Variable Région

```{r, include=FALSE}
#Modèle
mod_reg <- glm(statut_cas_temoin~region, family=binomial, data=data)

#Statistiques et intervalle de confiance
summary(mod_reg)
IC_sexe <- confint(mod_reg)
IC_exp_sexe <- exp(confint(mod_reg))

IC_sexe
IC_exp_sexe

anova(mod_reg, test = "Chisq")
```

Comme pour la variable 'sexe', le test global du $Chi^2$ n'est pas significatif (p\>0.05), indiquant l'abscence d'assiociation statistiquement significative entre la région et la survenue de l'infarctus du myocarde.

### Variable Tabagisme

```{r, include=FALSE}
#Modèle
mod_tabac <- glm(statut_cas_temoin~tabagisme, family=binomial, data=data)

#Statistiques et intervalle de confiance
summary(mod_tabac)
IC_tabac <- confint(mod_tabac)
IC_exp_tabac <- exp(confint(mod_tabac))

IC_tabac
IC_exp_tabac

anova(mod_tabac, test = "Chisq")
```

Modalité de référence : "Jamais".

-   On obtient : $\hat{\beta}_{ancien \space fumeur}$=0.51 qui estime $\beta_{ancien \space fumeur} = ln(\frac{odds(Y=1 \space | \space tabagisme =\text{ancien fumeur)}}{odds(Y=1 \space | \space tabagisme = Jamais)})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{ancien \space fumeur})\in [e^{0.07} ; e^{0.96}] = [1.07;2.61]$.

    Donc être un ancien fumeur va multiplier l'odds d'être cas par au moins exp(0.07)=1.07 et au plus exp(0.96)=2.61, par rapport à n'avoir jamais fumé. Cette association est statistiquement significative (p=0.0236).

-   On obtient : $\hat{\beta}_{fumeur \space actuel} =1.28 \text{ qui estime } \beta_{fumeur \space actuel} = ln(\frac{odds(Y=1 \space | \space tabagisme =\text{Fumeur actuel)}}{odds(Y=1 \space | \space tabagisme = Jamais)})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{fumeur \space actuel})\in [e^{0.85} ; e^{1.71}] = [2.34;5.56]$.

    Ainsi, être fumeur actuel va multiplier l'odds d'être cas par au moins exp(0.85)=2.34 et par au plus exp(1.71)=5.56, par rapport à n'avoir jamais fumé. Cette association est très significative (p\<0.001).

Le test du Chi² nous fournit une p-value inférieure au seuil 0.05 (1.3e-08), ce qui signifie que l'on rejette l'hypothèse nulle $H_0$ donc le tabagisme est statistiquement associée à la survenue de l'infarctus du myocarde.

### Variable Hypertension

```{r, include=FALSE}
#Modèle
mod_hypertension <- glm(statut_cas_temoin~hypertension, family=binomial, data=data)

#Statistiques et intervalle de confiance
summary(mod_hypertension)
IC_hypertension <- confint(mod_hypertension)
IC_exp_hypertension <- exp(confint(mod_hypertension))

IC_hypertension
IC_exp_hypertension

anova(mod_hypertension, test = "Chisq")
```

Modalité de référence : "Non".

On obtient : $\hat{\beta}_{hypertension \space oui}$=0.75 qui estime $\beta_{hypertension \space oui} = ln(\frac{odds(Y=1 \space | \space hypertension=Oui)}{odds(Y=1 \space | \space hypertension= Non)})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{hypertension \space oui})\in [e^{0.40} ; e^{1.11}] = [1.47;3.03]$.

Ainsi, être hypertendu va multiplier l'odds d'être cas par au moins exp(0.40)=1.47 et au plus exp(1.11)=3.03, par rapport à un sujet non hypertendu.

Le test du Chi² nous fournit une p-value inférieure au seuil 0.05 (3.6e-05), ce qui signifie que l'on rejette l'hypothèse nulle $H_0$ donc l'hypertension est statistiquement associée à la survenue de l'infarctus du myocarde.

### Variable Diabète

```{r, include=FALSE}
#Modèle
mod_diabete <- glm(statut_cas_temoin~diabete, family=binomial, data=data)

#Statistiques et intervalle de confiance
summary(mod_diabete)
IC_diabete <- confint(mod_diabete)
IC_exp_diabete <- exp(confint(mod_diabete))

IC_diabete
IC_exp_diabete

anova(mod_diabete, test = "Chisq")
```

Modalité de référence : "Non".

On obtient : $\hat{\beta}_{diabete\space oui}$=0.77 qui estime $\beta_{diabete\space oui} = ln(\frac{odds(Y=1 \space | \space diabete=Oui)}{odds(Y=1 \space | \space diabete= Non)})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{diabete\space oui})\in [e^{0.35} ; e^{1.21}] = [1.42;3.34]$.

Ainsi, être diabétique va multiplier l'odds d'être cas par au moins exp(0.35)=1.42 et au plus exp(1.21)=3.34, par rapport à un sujet non diabétique.

Le test du Chi² nous fournit une p-value inférieure au seuil 0.05 (3.2e-4), ce qui signifie que l'on rejette l'hypothèse nulle $H_0$ donc le diabète est statistiquement associée à la survenue de l'infarctus du myocarde.

### Variable Niveau d'activité physique

```{r, include=FALSE}
#Modèle
mod_act_phys <- glm(statut_cas_temoin~ niveau_activite_physique, family=binomial, data=data)

#Statistiques et intervalle de confiance
summary(mod_act_phys)
IC_act_phys <- confint(mod_act_phys)
IC_exp_act_phys <- exp(confint(mod_act_phys))

IC_act_phys
IC_exp_act_phys

anova(mod_act_phys, test = "Chisq")
```

Modalité de référence : "Elevée".

-   On obtient : $\hat{\beta}_{act. \space faible}$=1.45 qui estime $\beta_{act. \space faible} = ln(\frac{odds(Y=1 \space | \space niveau \space act. \space physique=\text{Faible)}}{odds(Y=1 \space | \space niveau \space act. \space physique= Elevée)})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{act. \space faible})\in [e^{0.91} ; e^{2.02}] = [2.48;7.51]$.

    Ainsi avoir un niveau d'activité faible va multiplier l'odds d'être cas par au moins exp(0.91)=2.48 et au plus exp(2.02)=7.51, par rapport aux individus avec une activité 'elevée'. Cette association est statistiquement significative (p=2.8e-4).

-   On obtient : $\hat{\beta}_{act. \space modérée} =0.48 \text{ qui estime } \beta_{act. \space modérée} = ln(\frac{odds(Y=1 \space | \space niveau \space act. \space physique=\text{Modérée)}}{odds(Y=1 \space | \space niveau \space act. \space physique= Elevée)})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{act. \space modérée})\in [e^{-0.09} ; e^{1.08}] = [0.91;2.93]$.

    Cependant, l'intervalle de confiance inclut 1 et la p-value = 0.104, ce qui signifie que l'association n'est pas statistiquement significative au seuil de 5%.

Le test global du Chi² nous fournit une p-value inférieure au seuil 0.05 (1.29e-09), ce qui signifie que l'on rejette l'hypothèse nulle $H_0$ et donc que le niveau d'activité physique est globalement statistiquement associée à la survenue de l'infarctus du myocarde.

Ces résultats suggèrent qu'une diminution du niveau d'activité physique augmente le risque d'être cas.

### Consommation d'alcool

```{r, include=FALSE}
#Modèle
mod_conso_alcool <- glm(statut_cas_temoin~consommation_alcool, family=binomial, data=data)

#Statistiques et intervalle de confiance
summary(mod_conso_alcool)
IC_conso_alcool <- confint(mod_conso_alcool)
IC_exp_conso_alcool <- exp(confint(mod_conso_alcool))

IC_conso_alcool
IC_exp_conso_alcool

anova(mod_conso_alcool, test = "Chisq")
```

Modalité de référence : "Aucune ou occasionnelle".

-   On obtient : $\hat{\beta}_{conso. \space elevée}$=1.15 qui estime $\beta_{conso. \space elevée} = ln(\frac{odds(Y=1 \space | \space conso. \space alcool=\text{Elevée)}}{odds(Y=1 \space | \space conso. \space alcool= \text{Aucune / occasionnelle})})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{conso. \space elevée})\in [e^{0.59} ; e^{1.76}] = [1.80;5.79]$.

    Ainsi avoir un niveau de consommation d'alcool élevée va multiplier l'odds d'être cas par au moins exp(0.59)=1.80 et au plus exp(1.76)=5.79, par rapport aux individus sans consommation ou avec une consommation occasionnelle. Cette association est statistiquement significative (p=9.77e-05).

-   On obtient : $\hat{\beta}_{conso. \space modérée} =0.35 \text{ qui estime } \beta_{conso.. \space modérée} = ln(\frac{odds(Y=1 \space | \space conso. \space alcool=\text{Modérée)}}{odds(Y=1 \space | \space conso. \space alcool= \text{Aucune / occasionnelle})})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{conso. \space modérée})\in [e^{-0.04} ; e^{0.73}] = [0.96;2.08]$.

    Cependant, l'intervalle de confiance inclut 1 et la p-value = 0.08, ce qui signifie que l'association n'est pas statistiquement significative au seuil de 5%.

Le test global du Chi² nous fournit une p-value inférieure au seuil 0.05 (1.9e-4), ce qui signifie que l'on rejette l'hypothèse nulle $H_0$ et donc que le niveau de consommation d'alcool est globalement statistiquement associée à la survenue de l'infarctus du myocarde.

Ces résultats suggèrent qu'une augmentation du niveau de consommation d'alcool augmente aussi le risque d'être cas.

## Regression multivariée logistique multiple

Les analyses univariées précédentes ont permis d'étudier séparément l'association entre chaque facteur de risque et la survenue de l'infarctus du myocarde. Cependant, ces associations peuvent être influencées par des facteurs de confusion. Ainsi, afin d'estimer l'association de chaque facteur en tenant compte des autres, une analyse multivariée est nécessaire.

Pour la sélection du modèle, nous avons utilisé une procédure de sélection descendante (backward) basée sur le critère de l'AIC : on part d'abord du modèle complet en incluant toutes les variables et on retire successivement les variables les moins significatives jusqu'à obtenir notre modèle optimal.

```{r}
#Création du modèle avec toutes les variables
mod_complet <- glm(statut_cas_temoin ~ age + sexe + tabagisme + imc + 
                     hypertension + diabete + cholesterol_total +
                     niveau_activite_physique + consommation_alcool + region,
                   family = binomial, data=data)

#Méthode Descendante
mod_final <- stepAIC(mod_complet, direction="backward", trace=FALSE)
coef(mod_final)

#Comparaison AIC
AIC(mod_complet, mod_final)

```

Résultats de la procédure :

-   Modèle complet : AIC = **526.83**

-   Modèle final : AIC = **525.09**

Le modèle final a exclu deux variables : **sexe** et **region**, ces variables n'apportent pas d'information significative. Les variables retenues dans le modèle final sont donc :

-   Age, Tabagisme, IMC, Hypertension, Diabète, Cholesterol total, Niveau d'activité physique, Consommation d'alcool.

```{r}
#Modèle final IC et coefficients
IC_final <- confint(mod_final)
IC_final

IC_exp_final <- exp(IC_final)
IC_exp_final
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
## Tableau comparatif manuel


# Fonction pour extraire OR et IC d'un modèle
extraire_OR <- function(modele, nom_var) {
  coef <- summary(modele)$coefficients
  OR <- exp(coef(modele))
  IC <- exp(confint(modele))
  
  # Pour les variables catégorielles, on prend les lignes correspondantes
  if (nom_var %in% rownames(coef)) {
    data.frame(
      Variable = nom_var,
      OR = round(OR[nom_var], 2),
      IC_inf = round(IC[nom_var, 1], 2),
      IC_sup = round(IC[nom_var, 2], 2),
      p_value = round(coef[nom_var, 4], 4)
    )
  }
}

# Créer un data frame avec tous les résultats
resultats <- data.frame(
  Variable = c(
    "Âge (par année)",
    "Tabagisme - Ancien fumeur",
    "Tabagisme - Fumeur actuel",
    "IMC (par kg/m²)",
    "Hypertension - Oui",
    "Diabète - Oui",
    "Cholestérol total (par mmol/L)",
    "Activité physique - Faible",
    "Activité physique - Modérée",
    "Consommation alcool - Élevée",
    "Consommation alcool - Modérée"
  ),
  
  # OR bruts (de vos analyses univariées)
  OR_brut = c(
    1.09,  # age (exp(0.083))
    1.67,  # ancien fumeur (exp(0.51))
    3.59,  # fumeur actuel (exp(1.28))
    1.16,  # imc (exp(0.148))
    2.11,  # hypertension (exp(0.75))
    2.16,  # diabete (exp(0.77))
    2.19,  # cholesterol (exp(0.785))
    4.26,  # act faible (exp(1.45))
    1.62,  # act modérée (exp(0.48))
    3.16,  # alcool élevée (exp(1.15))
    1.42   # alcool modérée (exp(0.35))
  ),
  
  IC_brut = c(
    "[1.06 ; 1.11]",
    "[1.07 ; 2.61]",
    "[2.34 ; 5.56]",
    "[1.10 ; 1.22]",
    "[1.47 ; 3.03]",
    "[1.42 ; 3.34]",
    "[1.79 ; 2.71]",
    "[2.48 ; 7.51]",
    "[0.91 ; 2.93]",
    "[1.80 ; 5.79]",
    "[0.96 ; 2.08]"
  ),
  
  p_brut = c(
    "<0.001",
    "0.024",
    "<0.001",
    "<0.001",
    "<0.001",
    "<0.001",
    "<0.001",
    "<0.001",
    "0.104",
    "<0.001",
    "0.080"
  ),
  
  # OR ajustés (de votre modèle final)
  OR_ajuste = c(
    1.08,  # exp(0.07871)
    1.50,  # exp(0.40746)
    2.70,  # exp(0.99496)
    1.17,  # exp(0.15562)
    1.98,  # exp(0.68176)
    2.19,  # exp(0.78333)
    2.18,  # exp(0.77941)
    2.85,  # exp(1.04782)
    1.38,  # exp(0.32442)
    2.88,  # exp(1.05850)
    1.60   # exp(0.47069)
  ),
  
  IC_ajuste = c(
    "[1.05 ; 1.11]",
    "[0.88 ; 2.59]",
    "[1.62 ; 4.57]",
    "[1.10 ; 1.25]",
    "[1.27 ; 3.10]",
    "[1.29 ; 3.75]",
    "[1.71 ; 2.82]",
    "[1.50 ; 5.56]",
    "[0.70 ; 2.79]",
    "[1.46 ; 5.86]",
    "[0.98 ; 2.63]"
  ),
  
  p_ajuste = c(
    "<0.001",
    "0.140",
    "<0.001",
    "<0.001",
    "0.003",
    "0.004",
    "<0.001",
    "0.002",
    "0.356",
    "0.003",
    "0.061"
  )
)

# Afficher le tableau
knitr::kable(
  resultats,
  col.names = c("Variable", "OR", "IC 95%", "p", "OR", "IC 95%", "p"),
  caption = "**Tableau.**
  Comparaison des odds ratios bruts (univariés) et ajustés (multivariés)",
  align = c("l", "c", "c", "c", "c", "c", "c")
) %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover")) %>%
  kableExtra::add_header_above(c(" " = 1, "Analyse univariée" = 3, "Analyse multivariée" = 3))
```

#### Tabagisme

Modalité de référence : "Jamais".

-   On obtient :

-   $\hat{\beta}_{ancien \space fumeur}$=0.407 qui estime $\beta_{ancien \space fumeur} = ln(\frac{odds(Y=1 \space | \space tabagisme =\text{ancien fumeur, } X_{-tabac} \text{ fixé})}{odds(Y=1 \space | \space tabagisme = Jamais, \space X_{-tabac} \text{ fixé})})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{ancien \space fumeur})\in [e^{-0.13} ; e^{0.95}] = [0.88;2.59]$.

    En analyse univariée, l'effet était significatif (p = 0.024 et IC = [1.07;2.61]). Après ajustement sur les autres facteurs de risque (âge, IMC, hypertension, diabète, cholestérol, activité physique, consommation d'alcool), cet effet n'est plus significatif. Cela suggère que l'association observée en univarié était en partie due à des facteurs confondants.

    ( $X_{-tabac}$ désigne toutes les autres covariables (maintenues fixes))

-   On obtient : $\hat{\beta}_{fumeur \space actuel} =0.995 \text{ qui estime } \beta_{fumeur \space actuel} = ln(\frac{odds(Y=1 \space | \space tabagisme =\text{Fumeur actuel, }X_{-tabac} \text{ fixé})}{odds(Y=1 \space | \space tabagisme = Jamais, \space X_{-tabac} \text{ fixé})})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{fumeur \space actuel})\in [e^{0.48} ; e^{1.52}] = [1.62;4.57]$.

    Ainsi, toutes choses égales par ailleurs, être fumeur actuel va multiplier l'odds d'être cas par au moins exp(0.48)=1.62 et par au plus exp(1.52)=4.57, par rapport à n'avoir jamais fumé. Cette association est très significative (p\<0.001).

    En univarié, l'intervalle de confiance était : [2.34;5.56]. En passant au modèle multivarié, le tabagisme actif reste significatif et est donc un facteur de risque de l'infarctus du myocarde. La diminution de l'odds ratio (IC et estimation) suggère qu'une partie de l'effet brut était dû à d'autres facteurs.

#### Activité Physique

Modalité de référence : "Elevée".

-   On obtient : $\hat{\beta}_{act. \space modérée} =0.324 \text{ qui estime } \beta_{act. \space modérée} = ln(\frac{odds(Y=1 \space | \space niveau \space act. \space physique=\text{Modérée, } \space X_{-act.phys.} \text{ fixé})}{odds(Y=1 \space | \space niveau \space act. \space physique= Elevée, \space \space X_{-act.phys.} \text{ fixé})})$. En analyse univariée comme en multivariée, les intervalles de confiance contiennent 1 et la p-value \> 0.05, ce qui signifie que l'association n'est pas statistiquement significative au seuil de 5%. Il n'y a donc pas de différence significative entre une activité modérée et une activité élevée en termes de risque d'infarctus.

<!-- -->

-   On obtient : $\hat{\beta}_{act. \space faible}$=1.048 qui estime $\beta_{act. \space faible} = ln(\frac{odds(Y=1 \space | \space niveau \space act. \space physique=\text{Faible,} \space X_{-act.phys.} \text{ fixé})}{odds(Y=1 \space | \space niveau \space act. \space physique= Elevée, \space X_{-act.phys.} \text{ fixé})})$. L'intervalle de confiance à 95% de l'odds ratio est : $exp(\beta_{act. \space faible})\in [e^{0.41} ; e^{1.72}] = [1.50;5.56]$.

    Ainsi, toutes choses égales par ailleurs, avoir un niveau d'activité faible multiplie l'odds d'être cas par au moins exp(0.41)=1.5 et au plus exp(1.72)=5.56, par rapport aux individus avec une activité 'elevée'. Cette association est statistiquement significative (p\<0.05).

    En univarié, l'intervalle de confiance était [2.48; 7.51]. En passant au modèle multivarié, une activité physique faible reste significatif et est donc un facteur de risque de l'infarctus du myocarde. La diminution de l'odds ratio (IC et estimation) suggère qu'une partie de l'effet brut était dû à d'autres facteurs, mais l'effet propre du tabagisme reste important.

#### Autres variables

Pour les variables **Age, IMC, Hypertension, Diabète, Cholesterol et consommation alcool,** les estimations et les intervalles de confiance en multivariée varient très peu par rapport à l'univarié, ce qui signifie que l'effet de ces variables est indépendant des autres facteurs de risque. Le léger élargissement des intervalles de confiance est attendu, car nous estimons un plus grand nombre de paramètres, ce qui réduit donc la précision des estimations individuelles.

Ces variables peuvent être considérées comme des facteurs de risque indépendants de l'infarctus du myocarde, leur effet n'étant pas beaucoup influencé par les autres covariables du modèle.

Après ajustement, les facteurs associés statistiquement à l'infarctus sont donc : age, tabagisme actif, IMC, hypertension, diabète, cholesterol, faible activité physique et consommation élevée d'alcool.

### Performance du modèle

La courbe ROC (Receiver Operating Characteristic) est un outil graphique permettant d'évaluer la performance d'un modèle de classification binaire (malade / non malade).

L'AUC (aire sous la courbe) mesure la probabilité que le modèle attribue une probabilité prédite plus élevée à un cas qu'à un témoin tiré au hasard :

-   AUC = 0.5 : aucun pouvoir discriminant (hasard)

-   0.7 $\leq$ AUC $<$ 0.8 : Discrimination acceptable

-   0.8 $\leq$ AUC $<$ 0.9 : Bonne discrimination

-   0.9 $\leq$ AUC : Excellente discrimination

```{r, message=FALSE, warning=FALSE}
#Courbe ROC
pred <- predict(mod_final, type="response")

roc <- roc(data$statut_cas_temoin, pred)

#Graphique
plot(roc, main = "Courbe ROC du modèle final")

legend("bottomright", legend = paste("AUC = ", round(auc(roc),3)), bty="n")

```

Dans notre étude, nous obtenons une aire sous la courbe ROC (AUC) de 0.85, ce qui indique une bonne capacité discriminante du modèle. Concrètement, cela signifie que 85% du temps, la probabilité prédite est plus élevée chez les individus cas que chez les individus témoins.

De plus, la courbe ROC s'éloigne nettement de la diagonale correspondant à un modèle aléatoire (AUC=0.5), ce qui confirme visuellement la bonne performance du modèle.

## Interactions dans le modèle

Nous avons pu mettre en avant plusieurs facteurs de risque associés à l'infarctus du myocarde. Cependant, il peut arriver que l'effet de certains facteurs dépende du niveau d'autres variables : c'est ce que l'on appelle une interaction. Par exemple, on pourrait imaginer que l'effet du tabagisme soit différent entre les hommes et les femmes, ou encore l'effet de l'IMC pourrait varier selon le niveau d'activité physique.

Dans la suite, nous allons donc tester plusieurs interactions plausibles.

#### Interactions testées

-   Tabagisme x Sexe

    L'effet du tabagisme peut être différent entre les hommes et les femmes.

-   Tabagisme x Age

    L'effet du tabagisme pourrait être plus important chez les personnes plus âgées.

-   IMC x Activité physique

    L'effet d'un IMC élevé pourrait être plus marqué chez les individu peu actifs.

-   Diabète x Hypertension

    Ces deux facteurs de risque cardiovasculaire pourraient avoir un effet synergique.

-   Cholestérol x Age

    L'effet du cholestérol pourrait être plus élevé chez les personne agées.

```{r, echo=FALSE}

#Tabac x Sexe
mod_inter_tabac_sexe <- glm(statut_cas_temoin ~ age + tabagisme*sexe + imc + 
                     hypertension + diabete + cholesterol_total +
                     niveau_activite_physique + consommation_alcool,
                   family = binomial, data=data)
#Tabac x Age
mod_inter_tabac_age <- glm(statut_cas_temoin ~ sexe + tabagisme*age + imc + 
                     hypertension + diabete + cholesterol_total +
                     niveau_activite_physique + consommation_alcool,
                   family = binomial, data=data)
#IMC x activité physique
mod_inter_imc_act <- glm(statut_cas_temoin ~ tabagisme + age + 
                     hypertension + diabete + cholesterol_total +
                     imc*niveau_activite_physique + consommation_alcool,
                   family = binomial, data=data)

#Diabète x Hypertension
mod_inter_diab_hyp <- glm(statut_cas_temoin ~ tabagisme + age + 
                     hypertension*diabete + cholesterol_total +
                     imc + niveau_activite_physique + consommation_alcool,
                   family = binomial, data=data)

#Cholestérol x Age
mod_inter_chol_age <- glm(statut_cas_temoin ~ tabagisme + 
                     hypertension + diabete + cholesterol_total*age +
                     imc + niveau_activite_physique + consommation_alcool,
                   family = binomial, data=data)

```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
p_tabac_sexe <- anova(mod_final, mod_inter_tabac_sexe, test = "Chisq")$`Pr(>Chi)`[2]
p_tabac_age <- anova(mod_final, mod_inter_tabac_age, test = "Chisq")$`Pr(>Chi)`[2]
p_imc_act <- anova(mod_final, mod_inter_imc_act, test = "Chisq")$`Pr(>Chi)`[2]
p_diabete_hta <- anova(mod_final, mod_inter_diab_hyp, test = "Chisq")$`Pr(>Chi)`[2]
p_chol_age <- anova(mod_final, mod_inter_chol_age, test = "Chisq")$`Pr(>Chi)`[2]

# Tableau récapitulatif
interactions_summary <- data.frame(
  Interaction = c("Tabagisme × Sexe", 
                  "Tabagisme × Âge", 
                  "IMC × Activité physique", 
                  "Diabète × Hypertension",
                  "Cholestérol × Âge"),
  P_value = round(c(p_tabac_sexe, p_tabac_age, p_imc_act, p_diabete_hta, p_chol_age), 3),
  Significative = ifelse(c(p_tabac_sexe, p_tabac_age, p_imc_act, p_diabete_hta, p_chol_age) < 0.05, 
                         "Oui", "Non")
)

knitr::kable(interactions_summary, 
             caption = "**Tableau X.** Résultats des tests d'interactions (test Anova)")
```

Aucune des cinq interactions testées n'est statistiquement significative au seuil de 5% (p-value\>0.3). Cela suggère que les effets des facteurs de risque sont additifs plutot que multiplicatifs. Cela signifie par exemple, que l'effet du cholestérol semble constant quel que soit l'age.

L'absence d'interactions significatives justifie donc le choix du modèle additif retenu précèdemment.

Cependant, l'absence d'interactions dans notre échantillon (n=520) ne signifie pas qu'elles n'existent pas dans la population générale.

## Modèle polytomique

A titre exploratoire, nous avons voulu inverser la relation $Y\sim E,F$ en $E \sim Y,F$ pour considérant des variables ordinales (tabagisme, consommation alcool, niveau d'activité physique) comme variables dépendantes. En effet, l'effet de l'exposition E sur la maladie Y à F fixé est le même que l'effet de Y sur E à F fixé.

Cette approche permet d'étudier les determinants de ces variables dans la population étudiée.

#### Exemple : Tabagisme

```{r}
#Création de la variable ordonnée
data$tabac_ord <- factor(data$tabagisme, ordered = TRUE,
                         levels =c("Jamais","Ancien fumeur","Fumeur actuel"))

#Modèle
mod_plr_complet <- polr(tabac_ord ~ age + sexe + imc + niveau_activite_physique +
                           statut_cas_temoin + hypertension + diabete + 
                           cholesterol_total,
                         data = data, Hess = TRUE)

#Selection variable
mod_plr_final <- stepAIC(mod_plr_complet, direction="backward", trace=FALSE)

#Résultat
coef(mod_plr_final)
confint(mod_plr_final)
exp(confint(mod_plr_final))
```

Les intervalles de confiance pour "niveau_activite_physique" contiennent 1, l'association n'est donc pas statistiquement significative. Cependant, le statut de cas est fortement associé à un niveau de tabagisme élevé :

$$ e^{-1.230} \leq \frac{odds(tabagisme\leq k | Cas)}{odds(tabagisme\leq k | Témoin)} \leq e^{-0.555} $$

(k représente un seuil, $k\in${Jamais, Ancien fumeur})

Ainsi, à activité physique fixée, être cas multiplie l'odds d'être dans une catégorie de tabagisme élevée d'au moins exp(0.555) = 1.74 et d'au plus exp(1.230) =3.42 par rapport aux témoins.

Ce résultat était attendu et ne modifie pas l'interprétation causale, le tabagisme reste un facteur de risque de l'infarctus du myocarde.

Des analyses analogues ont été réalisées sur la consommation d'alcool et le niveau d'activité physique, mais aussi la réalisation de modèle polytomique non ordonnée (variable Sexe et Region). Cependant cette approche s'est rélévée peu informative dans notre contexte.

## Conclusion 

Notre étude cas-témoin avait pour objectif d'identifier les principaux facteurs de risque associés à la survenue de l'infarctus du myocarde à partir d'un échantillon de 520 patients.

Les analyses univariées ont mis en évidence de nombreuses associations entre les facteurs étudiés et la survenue de l'infarctus, notamment l'âge, le tabagisme, l'IMC, l'hypertension artérielle, le diabète, le cholestérol, le niveau d'activité physique et la consommation d'alcool. Ces résultats confirment le rôle central des facteurs de risque cardiovasculaires classiques.

L'analyse multivariée, réalisée afin de tenir compte des facteurs de confusion, montre que la majorité de ces associations persistent. En particulier, **l'âge, le tabagisme actif, un IMC élevé, l'hypertension, le diabète, un taux élevé de cholesterol, une activité physique faible et une consommation élevée d'alcool** sont des facteurs de risque indépendants de l'infarctus du myocarde. En revanche, certaines associations observées en analyse univariée disparaissent après ajustement : le statut d'ancien fumeur n'est plus significatif, suggérant que son effet était en partie dû à des facteurs confondants. De même, le sexe et la région ne présentent pas d'association statistiquement significative.

Ces résultats soulignent l'importance des facteurs de risque modifiables (tabagisme, consommation d'alcool).

Le modèle final présente de bonnes performances discriminantes, avec une courbe (AUC) de 0.85. L'absence d'interactions significatives entre les variables valide le choix d'un modèle additif.

Limites : cette étude cas-témoin ne permet pas d'affirmer avec certitude que ces facteurs causent l'infarctus, mais seulement qu'ils y sont associés. De plus, d'autres variables n'étaient pas disponible comme les antécédents familiaux, alimentation, etc.

En perspective, si un suivi des patients dans le temps était disponible, une analyse de survie (modèle de cox) pourrait être réalisée afin d'étudier non seulement la survenue de l'infarctus mais aussi le temps jusqu'à l'évenement.
